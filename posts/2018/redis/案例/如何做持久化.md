首先，redis提供了RDB的功能做全量的持久化，其中`bgsave`命令可以让redis新开启一个子线程来进行持久化操作，但是当数据了大时，采用bgsave会很耗时，而且如果停机了，会导致数据丢失。

此时，需要使用AOF做搭配使用，它只会记录客户端的每次写操作，相对RDB数据会少很多。

因此在进行数据恢复时，应该优先使用AOF日志来恢复数据，如果没有，则使用RDB文件进行恢复。

如果AOF的文件也很大时，这时候就应该对AOF文件进行分割，redis提供了`auto-aof-rewrite-min-size`和`auto-aof-rewrite-percentage`来配置aof文件的大小和增长率。

为了防止在aof重写期间机器突然断电，需要根据自身实际需求，配置aof重写策略，redis提供了3种方式，always、everysec、no，如果采用每秒同步一次，那么顶多也就丢失一秒的数据。如果对性能没有要求，可以使用always，每条写命令都同步一次。
