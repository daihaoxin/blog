# 锁
## 全局锁
全局锁就是对整个数据库实例加锁，加锁之后，数据操作语句（DML）、数据定义语句（DDL）和更新类事务的提交语句，这些语句都会被阻塞。

加全局锁的命令如下：
```sql
Flush tables with read lock;
```

使用全局锁，一般是需要做全库逻辑备份的时候，但是这个时候整个数据库都会处于只读状态。

真正需要全库备份的时候，我们不会用它来做。我们知道在事务的隔离级别里，有一个叫**可重复读**，它会保证在事务期间，读取的数据都是一致的。借助它就可以在我们需要备份的时候，开启一个隔离级别为可重复读的事务来进行备份操作。mysql有个逻辑备份工具**mysqldump**可以做到
```sql
mysqldump -uroot -p123 --single-transaction db1 > db.sql;
```

但是这种方式只能用在支持事务的引擎，如InnoDB。如果使用的是MyISAM就不支持事务，因此无法使用`--single-transaction`，只能使用全局锁的方式进行备份。

既然全局锁是让全库只读，那设置数据库为只读状态的，还可以这样做` set global readonly=true`，但是我们不会这么做。    
主要是设置global的影响比较大，设置之后如果客户端发生异常，这时候数据库会一直处于readonly状态，导致数据库一直处于不可写的状态，风险很高。  
但是如果用全局锁的方式，如果客户端发生异常断开，这时数据库会自动释放这个全局锁，数据库便能恢复正常。